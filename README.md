# N-Body问题并行程序设计及性能优化

大三下分布式并行计算课程实验，利用cuda对 N-Body 算法进行优化。

## 实验原理

N-Body问题又称为多体问题，N表示任意正整数。它是天体力学和一般力学的基本问题之一，研究N个质点相互之间作用的运动规律，对其中每个质点的质量和初始位置、初始速度都不加任何限制。简单的说，N-Body问题是指找出已知初始位置、速度和质量的多个物体在经典力学情况下的后续运动，它既可以应用于宏观的天体，也可以应用于微观的分子、原子。

在有关多体问题（n>=3）的物理文学作品里有时会发现像“解决多体问题是不可能的”这样的描述。*n*体问题包含*6n*个变量，因为每个质点需要3个空间坐标和3个分速度表示。

即对于已知初始位置与速度、质量的n个变量，通过计算它们之间的相互作用力，求出每个变量在下一时刻的运动情况。

## 实验环境

计算节点配置：

    CPU E5-2660 v4*2

    Nvidia K80*2

    操作系统：CentOS 7.2

    CUDA：10.0

## nbody.cu

- 基准串行代码

- 计算结果正确，但平均每秒只有0.034 Billiom Interactions，代码性能低。

## nbody1.cu

- 实现了简单并行，每个线程计算一个节点的数据
- 并行化的代码平均每秒达到了36.855 Billion  Interactions，性能相比串行化代码有了显著的提升。

## nbody2.cu

- 进一步优化，多个线程计算一个节点的数据
- 平均每秒达到了215.093 Billion Interactions，性能相比优化前的并行化代码有了显著的提升。

优化前的代码1个线程处理1个节点，还有较多的空闲线程，没有充分利用GPU的计算资源。实现多个线程处理一个节点后，虽然会增加通信开销，但是多个线程并行带来的计算能力更强，性能也有所提升。同时，共享内存与循环展开的使用，也对性能有一定提升。
